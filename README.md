Это небольшой bash script но в тоже время очень надежный способ мониторить состояние ceph не успользуя при этом стороннего ПО. 
Все манипуляции небходимо проделовать на одной из нод вашего cepha, состояние которого вам необходимо отслеживать


скрипт запускает команду  и сравнивает ее вывод с предыдущем ее выводом,


(если это первый запуск, то просто запишет его в /tmp/laststatus.txt и вышлет результат в телегу)


при следующем запуске скрипт сравнит вывод ceph health detail с текстовиком и если он тотже, 


то ничего не делает,


если результат отличается, то перезапишет laststatus.txt и отошлет содержимое в телегу﻿


планировщик запускает скрипт раз в минуту таким образом с этим интервалом проверяет состояние cepha

 

1. Создаем пустой текстовый  laststatus.txt файл в /tmp/
    
   		nano /tmp/laststatus.txt


2. Создаем файл где нибудь. к примеру /usr/local/bin/ с расширением .sh
    
		nano /usr/local/bin/send.sh


3. Вставляем туда текст: 

		#!/bin/bash


		STATUS=$(ceph health detail)


		LASTSTATUS=$(cat /tmp/laststatus.txt)


		if [ "$(ceph health detail)" != "$LASTSTATUS" ]


			then


				url -s -X POST https://api.telegram.org/"токен_бота"/sendMessage -d chat_id="id_чата" -d text="имя_CEPH 


		$STATUS"


		fi


		ceph health detail > /tmp/laststatus.txt


5. Создайте бота с помощью botfather. Создайте чат и добавте туда вашего бота в качестве администратора

 
6. Укажите "токен_бота"


7. Укажите  "id_чата"


8. Укажите  text="имя_CEPH" (это будет заголовком в сообщении в telegram)


9. Сделаем наш файл исполняемым
    
		chmod 777 /usr/local/bin/send.sh


11. Создаем планировщик на выполнение /usr/local/bin/send.sh , в нашем случае, раз в минуту
    
		crontab -e


     в открывшемся редакторе вставляем:
    
			* * * * * /usr/bin/local/send.sh


11. Сохраняем.


	проверяем:
    
    		crontab -l

   	вывод должен быть таким

   			* * * * * /usr/bin/local/send.sh

